--[[ 
    ========== MM2 CUSTOM UI LIBRARY ========== 
    Дизайн: 100% Оригинал
    Структура: Модульная (Orion-like)
]]

local Library = {}

function Library.new()
    local Lib = {}
    
    -- [SETTINGS] Цвета и настройки из оригинала
    local SETTINGS = {
        Colors = {
            MainBackground = Color3.fromRGB(40, 40, 40),
            TopBar = Color3.fromRGB(25, 25, 25),
            SectionBg = Color3.fromRGB(25, 25, 25),
            TextMain = Color3.fromRGB(255, 255, 255),
            TextDim = Color3.fromRGB(180, 180, 180),
            Stroke = Color3.fromRGB(190, 190, 190),
            Divider = Color3.fromRGB(160, 160, 160),
            CheckboxActive = Color3.fromRGB(255, 255, 255),
            CheckboxOff = Color3.fromRGB(60, 60, 60),
            Highlight = Color3.fromRGB(200, 200, 200),
            StatsBox = Color3.fromRGB(50, 50, 50),
            StatsText = Color3.fromRGB(255, 255, 255),
            CopyBtnNormal = Color3.fromRGB(60, 60, 60),
            CopyBtnClick = Color3.fromRGB(180, 180, 180)
        },
        Fonts = {
            Title = Enum.Font.DenkOne,
            TabButton = Enum.Font.DenkOne,
            ItemTitle = Enum.Font.SourceSansBold,
            ItemDesc = Enum.Font.SourceSans,
            WindowBtn = Enum.Font.SourceSansBold,
            Stats = Enum.Font.DenkOne
        },
        Sizes = {
            CornerRadius = 18,
            ItemHeight = 38,
            ItemGap = 14,
            TopHeight = 56,
            Padding = 9,
            StatsBoxHeight = 85,
            StatsTopMargin = 45,
            StatsFontSize = 15,
            StatsTextGap = 4
        },
        Transparency = {
            Background = 0.12,
            Stroke = 0.55,
            Divider = 0.65,
            Highlight = 0.25,
            StatsBox = 0.2
        }
    }

    local CoreGui = game:GetService("CoreGui")
    local LP = game:GetService("Players").LocalPlayer
    local UIS = game:GetService("UserInputService")
    local GUI_NAME = "MM2Hub_Interface"

    -- Очистка старого GUI
    if CoreGui:FindFirstChild(GUI_NAME) then CoreGui:FindFirstChild(GUI_NAME):Destroy() end
    if LP.PlayerGui:FindFirstChild(GUI_NAME) then LP.PlayerGui:FindFirstChild(GUI_NAME):Destroy() end

    function Lib:CreateWindow(Settings)
        local TitleText = Settings.Name or "Hub"
        
        local gui = Instance.new("ScreenGui")
        gui.Name = GUI_NAME
        gui.ResetOnSpawn = false
        if pcall(function() gui.Parent = CoreGui end) then gui.Parent = CoreGui else gui.Parent = LP.PlayerGui end

        -- Кнопка Show (свернутое состояние)
        local showContainer = Instance.new("Frame", gui)
        showContainer.Size = UDim2.new(0, 140, 0, 40)
        showContainer.Position = UDim2.new(0.5, -70, 0, 14)
        showContainer.BackgroundColor3 = SETTINGS.Colors.TopBar
        showContainer.BackgroundTransparency = SETTINGS.Transparency.Background
        showContainer.Visible = false
        Instance.new("UICorner", showContainer).CornerRadius = UDim.new(0, 14)
        
        local showStroke = Instance.new("UIStroke", showContainer)
        showStroke.Color = SETTINGS.Colors.Stroke; showStroke.Transparency = SETTINGS.Transparency.Stroke
        
        local showBtn = Instance.new("TextButton", showContainer)
        showBtn.Size = UDim2.fromScale(1, 1); showBtn.BackgroundTransparency = 1
        showBtn.Text = "Show"; showBtn.Font = SETTINGS.Fonts.ItemTitle
        showBtn.TextSize = 18; showBtn.TextColor3 = SETTINGS.Colors.TextMain

        -- Главное окно
        local main = Instance.new("Frame", gui)
        main.Size = UDim2.fromScale(0.52, 0.85)
        main.Position = UDim2.fromScale(0.24, 0.075)
        main.BackgroundColor3 = SETTINGS.Colors.MainBackground
        main.BackgroundTransparency = SETTINGS.Transparency.Background
        Instance.new("UICorner", main).CornerRadius = UDim.new(0, SETTINGS.Sizes.CornerRadius)
        
        local mainStroke = Instance.new("UIStroke", main)
        mainStroke.Color = SETTINGS.Colors.Stroke; mainStroke.Transparency = SETTINGS.Transparency.Stroke

        -- Верхняя панель
        local top = Instance.new("Frame", main)
        top.Size = UDim2.new(1, 0, 0, SETTINGS.Sizes.TopHeight)
        top.BackgroundColor3 = SETTINGS.Colors.TopBar; top.ZIndex = 3
        Instance.new("UICorner", top).CornerRadius = UDim.new(0, SETTINGS.Sizes.CornerRadius)

        local titleIcon = Instance.new("ImageLabel", top)
        titleIcon.Size = UDim2.new(0, 32, 0, 32); titleIcon.Position = UDim2.new(0, 14, 0, 12)
        titleIcon.BackgroundTransparency = 1; titleIcon.Image = "rbxassetid://99419671323896"; titleIcon.ZIndex = 4

        local titleLbl = Instance.new("TextLabel", top)
        titleLbl.Size = UDim2.new(1, -160, 1, 0); titleLbl.Position = UDim2.new(0, 56, 0, 0)
        titleLbl.BackgroundTransparency = 1; titleLbl.Text = TitleText
        titleLbl.Font = SETTINGS.Fonts.Title; titleLbl.TextSize = 19
        titleLbl.TextXAlignment = Enum.TextXAlignment.Left; titleLbl.TextColor3 = SETTINGS.Colors.TextMain; titleLbl.ZIndex = 4

        -- Кнопки окна
        local function WinBtn(txt, off)
            local b = Instance.new("TextButton", top)
            b.Size = UDim2.new(0, 36, 0, 36); b.Position = UDim2.new(1, off, 0, 10)
            b.BackgroundTransparency = 1; b.Text = txt; b.Font = SETTINGS.Fonts.WindowBtn
            b.TextSize = 32; b.TextColor3 = SETTINGS.Colors.TextMain; b.ZIndex = 5
            return b
        end
        WinBtn("–", -96).MouseButton1Click:Connect(function() main.Visible = false; showContainer.Visible = true end)
        WinBtn("×", -48).MouseButton1Click:Connect(function() gui:Destroy() end)
        showBtn.MouseButton1Click:Connect(function() main.Visible = true; showContainer.Visible = false end)

        -- Панели
        local contentY = SETTINGS.Sizes.TopHeight + SETTINGS.Sizes.Padding
        local leftP = Instance.new("Frame", main)
        leftP.Position = UDim2.new(0, SETTINGS.Sizes.Padding, 0, contentY)
        leftP.Size = UDim2.new(0.333, -SETTINGS.Sizes.Padding * 1.5, 1, -contentY - SETTINGS.Sizes.Padding)
        leftP.BackgroundColor3 = SETTINGS.Colors.SectionBg; leftP.BackgroundTransparency = SETTINGS.Transparency.Background
        Instance.new("UICorner", leftP).CornerRadius = UDim.new(0, 16)

        local rightP = Instance.new("Frame", main)
        rightP.Position = UDim2.new(0.333, SETTINGS.Sizes.Padding / 2, 0, contentY)
        rightP.Size = UDim2.new(0.667, -SETTINGS.Sizes.Padding * 1.5, 1, -contentY - SETTINGS.Sizes.Padding)
        rightP.BackgroundColor3 = SETTINGS.Colors.SectionBg; rightP.BackgroundTransparency = SETTINGS.Transparency.Background
        Instance.new("UICorner", rightP).CornerRadius = UDim.new(0, 16)

        -- Драггинг
        local dragging, dragInput, dragStart, startPos
        top.InputBegan:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
                dragging = true; dragStart = input.Position; startPos = main.Position
                input.Changed:Connect(function() if input.UserInputState == Enum.UserInputState.End then dragging = false end end)
            end
        end)
        top.InputChanged:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then dragInput = input end
        end)
        UIS.InputChanged:Connect(function(input)
            if input == dragInput and dragging then
                local delta = input.Position - dragStart
                main.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
            end
        end)

        local WindowHandler = {TabCount = 0, CurrentTabY = 14, ActiveHighlight = nil}

        function WindowHandler:CreateTab(TabSettings)
            local TabName = TabSettings.Name or "Tab"
            local NoLine = TabSettings.NoLine or false
            
            -- Страница справа
            local Page = Instance.new("Frame", rightP)
            Page.Name = TabName; Page.Size = UDim2.fromScale(1, 1)
            Page.BackgroundTransparency = 1; Page.Visible = false

            -- Кнопка слева
            local holder = Instance.new("Frame", leftP)
            holder.Size = UDim2.new(1, -24, 0, SETTINGS.Sizes.ItemHeight)
            holder.Position = UDim2.new(0, 12, 0, self.CurrentTabY)
            holder.BackgroundTransparency = 1

            local highlight = Instance.new("Frame", holder)
            highlight.Size = UDim2.fromScale(1, 1); highlight.BackgroundColor3 = SETTINGS.Colors.Highlight
            highlight.BackgroundTransparency = SETTINGS.Transparency.Highlight; highlight.Visible = false
            Instance.new("UICorner", highlight).CornerRadius = UDim.new(0, 12)

            local btn = Instance.new("TextButton", holder)
            btn.Size = UDim2.fromScale(1, 1); btn.BackgroundTransparency = 1
            btn.Text = TabName; btn.Font = SETTINGS.Fonts.TabButton
            btn.TextSize = 18; btn.TextColor3 = SETTINGS.Colors.TextMain

            -- Логика переключения
            if self.TabCount == 0 then
                highlight.Visible = true; self.ActiveHighlight = highlight; Page.Visible = true
            end
            
            btn.MouseButton1Click:Connect(function()
                if self.ActiveHighlight then self.ActiveHighlight.Visible = false end
                for _, p in pairs(rightP:GetChildren()) do if p:IsA("Frame") then p.Visible = false end end
                highlight.Visible = true; self.ActiveHighlight = highlight; Page.Visible = true
            end)

            if not NoLine then
                local line = Instance.new("Frame", leftP)
                line.Size = UDim2.new(1, -40, 0, 1)
                line.Position = UDim2.new(0, 20, 0, self.CurrentTabY + SETTINGS.Sizes.ItemHeight + 6)
                line.BackgroundColor3 = SETTINGS.Colors.Divider; line.BackgroundTransparency = 0.45
            end

            self.CurrentTabY = self.CurrentTabY + SETTINGS.Sizes.ItemHeight + SETTINGS.Sizes.ItemGap
            self.TabCount = self.TabCount + 1

            local TabHandler = {Page = Page, CurrentY = 14}

            function TabHandler:CreateToggle(ItemSettings)
                local Title = ItemSettings.Name or "Toggle"
                local Desc = ItemSettings.Desc or ""
                local Callback = ItemSettings.Callback or function() end
                local NoLine = ItemSettings.NoLine or false
                local Default = ItemSettings.Default or false

                local btn = Instance.new("TextButton", self.Page)
                btn.Size = UDim2.new(1, -30, 0, SETTINGS.Sizes.ItemHeight)
                btn.Position = UDim2.new(0, 15, 0, self.CurrentY)
                btn.BackgroundTransparency = 1; btn.Text = ""; btn.AutoButtonColor = false

                local tLbl = Instance.new("TextLabel", btn)
                tLbl.Size = UDim2.new(1, -60, 0, 18); tLbl.BackgroundTransparency = 1
                tLbl.Text = Title; tLbl.Font = SETTINGS.Fonts.ItemTitle
                tLbl.TextSize = 16; tLbl.TextColor3 = SETTINGS.Colors.TextMain
                tLbl.TextXAlignment = Enum.TextXAlignment.Left

                local dLbl = Instance.new("TextLabel", btn)
                dLbl.Size = UDim2.new(1, -60, 0, 14); dLbl.Position = UDim2.new(0, 0, 0, 18)
                dLbl.BackgroundTransparency = 1; dLbl.Text = Desc
                dLbl.Font = SETTINGS.Fonts.ItemDesc; dLbl.TextSize = 12
                dLbl.TextColor3 = SETTINGS.Colors.TextDim; dLbl.TextXAlignment = Enum.TextXAlignment.Left

                local box = Instance.new("Frame", btn)
                box.Size = UDim2.new(0, 22, 0, 22); box.Position = UDim2.new(1, -26, 0.5, -11)
                box.BackgroundColor3 = Default and SETTINGS.Colors.CheckboxActive or SETTINGS.Colors.CheckboxOff
                Instance.new("UICorner", box).CornerRadius = UDim.new(0, 6)
                local bs = Instance.new("UIStroke", box); bs.Color = Color3.fromRGB(200,200,200); bs.Transparency = 0.5; bs.Thickness = 1.5

                local toggled = Default
                btn.MouseButton1Click:Connect(function()
                    toggled = not toggled
                    box.BackgroundColor3 = toggled and SETTINGS.Colors.CheckboxActive or SETTINGS.Colors.CheckboxOff
                    Callback(toggled)
                end)

                if not NoLine then
                    local l = Instance.new("Frame", self.Page)
                    l.Size = UDim2.new(1, -40, 0, 1); l.Position = UDim2.new(0, 20, 0, self.CurrentY + SETTINGS.Sizes.ItemHeight + 6)
                    l.BackgroundColor3 = SETTINGS.Colors.Divider; l.BackgroundTransparency = SETTINGS.Transparency.Divider
                end
                self.CurrentY = self.CurrentY + 52
            end

            function TabHandler:CreateSocial(ItemSettings)
                local Title = ItemSettings.Name or "Social"
                local Desc = ItemSettings.Desc or ""
                local Content = ItemSettings.Content or ""
                local NoLine = ItemSettings.NoLine or false

                local f = Instance.new("Frame", self.Page)
                f.Size = UDim2.new(1, -30, 0, SETTINGS.Sizes.ItemHeight)
                f.Position = UDim2.new(0, 15, 0, self.CurrentY); f.BackgroundTransparency = 1

                local t = Instance.new("TextLabel", f)
                t.Size = UDim2.new(1, -80, 0, 18); t.BackgroundTransparency = 1
                t.Text = Title; t.Font = SETTINGS.Fonts.ItemTitle; t.TextSize = 16
                t.TextXAlignment = Enum.TextXAlignment.Left
                task.spawn(function() while t.Parent do t.TextColor3 = Color3.fromHSV((tick()%5)/5,1,1) task.wait() end end)

                local d = Instance.new("TextLabel", f)
                d.Size = UDim2.new(1, -80, 0, 14); d.Position = UDim2.new(0, 0, 0, 18)
                d.BackgroundTransparency = 1; d.Text = Desc; d.Font = SETTINGS.Fonts.ItemDesc
                d.TextSize = 12; d.TextColor3 = SETTINGS.Colors.TextDim; d.TextXAlignment = Enum.TextXAlignment.Left

                local b = Instance.new("TextButton", f)
                b.Size = UDim2.new(0, 60, 0, 24); b.Position = UDim2.new(1, -64, 0.5, -12)
                b.BackgroundColor3 = SETTINGS.Colors.CopyBtnNormal; b.Text = "Copy"
                b.Font = SETTINGS.Fonts.ItemTitle; b.TextSize = 14; b.TextColor3 = SETTINGS.Colors.TextMain
                Instance.new("UICorner", b).CornerRadius = UDim.new(0, 6)

                b.MouseButton1Click:Connect(function()
                    if setclipboard then setclipboard(Content) end
                    b.BackgroundColor3 = SETTINGS.Colors.CopyBtnClick
                    task.wait(0.2); b.BackgroundColor3 = SETTINGS.Colors.CopyBtnNormal
                end)

                if not NoLine then
                    local l = Instance.new("Frame", self.Page)
                    l.Size = UDim2.new(1, -40, 0, 1); l.Position = UDim2.new(0, 20, 0, self.CurrentY + SETTINGS.Sizes.ItemHeight + 6)
                    l.BackgroundColor3 = SETTINGS.Colors.Divider; l.BackgroundTransparency = SETTINGS.Transparency.Divider
                end
                self.CurrentY = self.CurrentY + 52
            end

            function TabHandler:CreateStats()
                local box = Instance.new("Frame", self.Page)
                box.Size = UDim2.new(1, -30, 0, SETTINGS.Sizes.StatsBoxHeight)
                box.Position = UDim2.new(0, 15, 0, self.CurrentY + SETTINGS.Sizes.StatsTopMargin)
                box.BackgroundColor3 = SETTINGS.Colors.StatsBox; box.BackgroundTransparency = SETTINGS.Transparency.StatsBox
                Instance.new("UICorner", box).CornerRadius = UDim.new(0, 12)
                local s = Instance.new("UIStroke", box); s.Color = SETTINGS.Colors.Stroke; s.Transparency = 0.3

                local layout = Instance.new("UIListLayout", box); layout.SortOrder = Enum.SortOrder.LayoutOrder
                layout.Padding = UDim.new(0, SETTINGS.Sizes.StatsTextGap); layout.VerticalAlignment = Enum.VerticalAlignment.Center
                local pad = Instance.new("UIPadding", box); pad.PaddingLeft = UDim.new(0, 12)

                local function mkLbl(ord)
                    local l = Instance.new("TextLabel", box); l.LayoutOrder = ord
                    l.Size = UDim2.new(1, 0, 0, SETTINGS.Sizes.StatsFontSize + 4); l.BackgroundTransparency = 1
                    l.TextColor3 = SETTINGS.Colors.StatsText; l.Font = SETTINGS.Fonts.Stats
                    l.TextSize = SETTINGS.Sizes.StatsFontSize; l.TextXAlignment = Enum.TextXAlignment.Left
                    return l
                end
                return {Time = mkLbl(1), Coins = mkLbl(2), Footer = mkLbl(3)}
            end

            return TabHandler
        end
        return WindowHandler
    end
    return Lib
end
return Library
