-- UI LIBRARY (MODULE)
local UIS = game:GetService("UserInputService")
local Player = game.Players.LocalPlayer

local UI = {}
UI.__index = UI

-- =====================
-- UTILS
-- =====================

local function round(obj, r)
	local c = Instance.new("UICorner")
	c.CornerRadius = UDim.new(0, r)
	c.Parent = obj
end

local function draggable(frame, handle)
	handle.Active = true
	handle.Selectable = true

	local drag = false
	local startPos, startFrame

	handle.InputBegan:Connect(function(i)
		if i.UserInputType == Enum.UserInputType.MouseButton1 then
			drag = true
			startPos = i.Position
			startFrame = frame.Position

			i.Changed:Connect(function()
				if i.UserInputState == Enum.UserInputState.End then
					drag = false
				end
			end)
		end
	end)

	UIS.InputChanged:Connect(function(i)
		if drag and i.UserInputType == Enum.UserInputType.MouseMovement then
			local delta = i.Position - startPos
			frame.Position = UDim2.new(
				startFrame.X.Scale,
				startFrame.X.Offset + delta.X,
				startFrame.Y.Scale,
				startFrame.Y.Offset + delta.Y
			)
		end
	end)
end

-- =====================
-- CREATE WINDOW
-- =====================

function UI:CreateWindow(titleText)
	local Window = {}
	Window.__index = Window

	-- ScreenGui
	local gui = Instance.new("ScreenGui")
	gui.ResetOnSpawn = false
	gui.Parent = Player:WaitForChild("PlayerGui")

	-- Main
	local main = Instance.new("Frame")
	main.Size = UDim2.fromOffset(520, 360)
	main.Position = UDim2.fromScale(0.5, 0.5)
	main.AnchorPoint = Vector2.new(0.5, 0.5)
	main.BackgroundColor3 = Color3.fromRGB(28,28,28)
	main.Parent = gui
	round(main, 10)

	-- Top bar
	local top = Instance.new("Frame")
	top.Size = UDim2.new(1,0,0,32)
	top.BackgroundColor3 = Color3.fromRGB(22,22,22)
	top.Parent = main
	round(top, 10)

	-- Title
	local title = Instance.new("TextLabel")
	title.Text = titleText or "Window"
	title.BackgroundTransparency = 1
	title.TextXAlignment = Left
	title.Font = Enum.Font.GothamMedium
	title.TextSize = 14
	title.TextColor3 = Color3.fromRGB(230,230,230)
	title.Size = UDim2.new(1,-80,1,0)
	title.Position = UDim2.new(0,10,0,0)
	title.Parent = top

	-- Buttons
	local close = Instance.new("TextButton")
	close.Text = "X"
	close.BackgroundTransparency = 1
	close.Size = UDim2.fromOffset(24,24)
	close.Position = UDim2.new(1,-28,0,4)
	close.Parent = top

	local collapse = Instance.new("TextButton")
	collapse.Text = "^"
	collapse.BackgroundTransparency = 1
	collapse.Size = UDim2.fromOffset(24,24)
	collapse.Position = UDim2.new(1,-56,0,4)
	collapse.Parent = top

	-- Sections holder
	local sections = Instance.new("Frame")
	sections.Size = UDim2.new(0,150,1,-32)
	sections.Position = UDim2.new(0,0,0,32)
	sections.BackgroundTransparency = 1
	sections.Parent = main

	local layout = Instance.new("UIListLayout")
	layout.Padding = UDim.new(0,6)
	layout.HorizontalAlignment = Center
	layout.Parent = sections

	local pad = Instance.new("UIPadding")
	pad.PaddingTop = UDim.new(0,8)
	pad.Parent = sections

	draggable(main, top)

	-- Logic
	close.MouseButton1Click:Connect(function()
		gui:Destroy()
	end)

	local collapsed = false
	collapse.MouseButton1Click:Connect(function()
		collapsed = not collapsed
		collapse.Text = collapsed and "v" or "^"
		sections.Visible = not collapsed
		main.Size = collapsed and UDim2.fromOffset(520,32) or UDim2.fromOffset(520,360)
	end)

	-- API
	function Window:CreateSection(name)
		local s = Instance.new("TextButton")
		s.Size = UDim2.fromOffset(130,26)
		s.BackgroundColor3 = Color3.fromRGB(48,48,48)
		s.Text = name or "Section"
		s.Font = Enum.Font.Gotham
		s.TextSize = 12
		s.TextColor3 = Color3.fromRGB(230,230,230)
		s.AutoButtonColor = false
		s.Parent = sections
		round(s, 6)
		return s
	end

	return Window
end

return UI
