local Library = {}
Library.__index = Library

local UIS = game:GetService("UserInputService")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")

-- контейнер под все окна
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "CustomUILibrary"
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = PlayerGui

-- настройки
Library.WindowCount = 0
Library.MaxWindows = 5
Library.Windows = {}

-- функция драггинга
local function MakeDraggable(frame, dragHandle)
    dragHandle = dragHandle or frame

    local dragging = false
    local dragInput, mousePos, framePos

    dragHandle.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            mousePos = input.Position
            framePos = frame.Position

            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)

    dragHandle.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement then
            dragInput = input
        end
    end)

    UIS.InputChanged:Connect(function(input)
        if input == dragInput and dragging then
            local delta = input.Position - mousePos
            frame.Position = UDim2.new(
                framePos.X.Scale,
                framePos.X.Offset + delta.X,
                framePos.Y.Scale,
                framePos.Y.Offset + delta.Y
            )
        end
    end)
end

-- создание окна
function Library:CreateWindow(options)
    if Library.WindowCount >= Library.MaxWindows then
        warn("Max window limit reached (5)")
        return
    end

    Library.WindowCount += 1

    local windowName = options.Name or "Window"

    -- позиция правее предыдущего
    local startX = 50 + ((Library.WindowCount - 1) * 420)

    local Main = Instance.new("Frame")
    Main.Size = UDim2.new(0, 400, 0, 120)
    Main.Position = UDim2.new(0, startX, 0, 100)
    Main.BackgroundColor3 = Color3.fromRGB(74,74,74)
    Main.BorderSizePixel = 0
    Main.Parent = ScreenGui
    Main.Name = windowName

    local UICorner = Instance.new("UICorner", Main)
    UICorner.CornerRadius = UDim.new(0, 6)

    -- заголовок
    local Title = Instance.new("TextLabel")
    Title.Size = UDim2.new(1, 0, 0, 28)
    Title.BackgroundTransparency = 1
    Title.Text = windowName
    Title.Font = Enum.Font.GothamBold
    Title.TextSize = 14
    Title.TextColor3 = Color3.fromRGB(255,255,255)
    Title.Parent = Main

    -- делаем окно перетаскиваемым
    MakeDraggable(Main, Title)

    local Window = {}
    Window.Instance = Main

    table.insert(Library.Windows, Window)

    return Window
end

return Library
